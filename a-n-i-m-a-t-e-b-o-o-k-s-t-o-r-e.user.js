// ==UserScript==
// @name         a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e
// @namespace    https://github.com/kanekoryusei5678/thuyen_lai_buon/raw/main/a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e.user.js
// @version      2024.08.17
// @description  down a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e
// @author       You
// @include      /^https:\/\/www\.[a@]nim[a@]teb[o0]okst[o0]re\.c[o0]m\/viewer\/.+/
// @icon         https://raw.githubusercontent.com/kanekoryusei5678/thuyen_lai_buon/main/a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e.png
// @grant        GM_download
// @grant        GM_info
// @downloadURL  https://github.com/kanekoryusei5678/thuyen_lai_buon/raw/main/a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e.user.js
// @updateURL    https://github.com/kanekoryusei5678/thuyen_lai_buon/raw/main/a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e.meta.js
// ==/UserScript==

(function(_0x2a2882,_0x1ff719){const _0x314fe6=a0_0x5b05,_0x5404c8=_0x2a2882();while(!![]){try{const _0x39a12b=-parseInt(_0x314fe6(0x99))/0x1*(-parseInt(_0x314fe6(0xd9))/0x2)+-parseInt(_0x314fe6(0xd0))/0x3*(parseInt(_0x314fe6(0x9e))/0x4)+-parseInt(_0x314fe6(0xbe))/0x5*(-parseInt(_0x314fe6(0xbb))/0x6)+-parseInt(_0x314fe6(0xcd))/0x7+parseInt(_0x314fe6(0xbc))/0x8*(parseInt(_0x314fe6(0xec))/0x9)+-parseInt(_0x314fe6(0x88))/0xa+parseInt(_0x314fe6(0xb4))/0xb;if(_0x39a12b===_0x1ff719)break;else _0x5404c8['push'](_0x5404c8['shift']());}catch(_0x2b3a5c){_0x5404c8['push'](_0x5404c8['shift']());}}}(a0_0x320f,0xb0687));let downloading_current=0x0,downloading_total=0x0;const downloadMode=GM_info['downloadMode'];let folder_title='',api_url_root='';function a0_0x5b05(_0x24313a,_0x31bea3){const _0x320f1d=a0_0x320f();return a0_0x5b05=function(_0x5b05ee,_0x59d511){_0x5b05ee=_0x5b05ee-0x85;let _0x6eee2d=_0x320f1d[_0x5b05ee];return _0x6eee2d;},a0_0x5b05(_0x24313a,_0x31bea3);}function sleep(_0x5283d9){return new Promise(_0x42cdd7=>setTimeout(_0x42cdd7,_0x5283d9));}function a0_0x320f(){const _0x4648b2=['shift','position','getContext','0.5rem','0\x202rem','rel','\x20/\x20','charCodeAt','tai-ve','log','subtle','alignItems','next','15677046SyPYBQ','map','setAttribute','src','webkitTextStroke','.25rem\x20.4rem\x20#2E8B87','Failed\x20to\x20load\x20image','24EVWpjx','40LBwxKE','image/jpeg','160235KVyevs','click','padding','#heartbeat','backgroundColor','link','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','all','replace','none','body','match','appendChild','.status-num','\x27Acme\x27,\x20sans-serif','8184533GpprUq','div','parse','57aalPfx','boxShadow','length','padStart','1px\x20#C62428','naturalHeight','textContent','borderRadius','https://fonts.googleapis.com/css2?family=Acme&display=swap','434666AQhHrJ','insertBefore','getElementsByTagName','3rem','byteLength','50vw','string','flex','toBlob','pointer','raw','SHA-256','gap','browser','fontSize','error','splice','addEventListener','fromCharCode','857970vtiTBR','status','Anonymous','querySelector','3290280OCbeoT','canvas','href','createElement','#FD7377','split','encode','documentElement','display','absolute','translate(-50%)','top','createObjectURL','cursor','zIndex','img','style','1kKezja','Error','className','crypto','#F9FDFD','5588BJaVwF','center','sign','1.5rem','round','head','drawImage','floor','width'];a0_0x320f=function(){return _0x4648b2;};return a0_0x320f();}const load_image=_0x47e716=>new Promise((_0x5e3882,_0x22fb6b)=>{const _0x3306c9=a0_0x5b05,_0x588c39=new Image();_0x588c39[_0x3306c9(0xea)]('load',()=>{_0x5e3882(_0x588c39);}),_0x588c39['addEventListener'](_0x3306c9(0xe8),()=>{const _0x50e9b8=_0x3306c9;_0x22fb6b(new Error(_0x50e9b8(0xba)));}),_0x588c39[_0x3306c9(0xb7)]=_0x47e716,_0x588c39['crossOrigin']=_0x3306c9(0x86);}),on_heartbeat_css=()=>{const _0x41d326=a0_0x5b05;let _0x1661a7=document[_0x41d326(0x87)]('#heartbeat');!_0x1661a7&&(_0x1661a7=document['createElement'](_0x41d326(0x98)),_0x1661a7['setAttribute']('id','heartbeat'),document[_0x41d326(0xa3)]['appendChild'](_0x1661a7)),_0x1661a7[_0x41d326(0xd6)]='\x0a\x20\x20\x20\x20\x20\x20.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform-origin:\x20center;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20@keyframes\x20heartbeat\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2025%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2050%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2075%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20';},off_heartbeat_css=()=>{const _0x236211=a0_0x5b05,_0x4756a4=document[_0x236211(0x87)](_0x236211(0xc1));_0x4756a4[_0x236211(0xd6)]='';};function update_status(){const _0x39635a=a0_0x5b05;document[_0x39635a(0x87)]('.status-num')[_0x39635a(0x98)][_0x39635a(0x90)]='block',document[_0x39635a(0x87)](_0x39635a(0xcb))['innerHTML']=downloading_current+_0x39635a(0xad)+downloading_total;}function create_status_box(){const _0x3a04fa=a0_0x5b05;let _0xb20bf5=document[_0x3a04fa(0x8b)](_0x3a04fa(0xce));return _0xb20bf5[_0x3a04fa(0x9b)]='status-num',_0xb20bf5[_0x3a04fa(0xd6)]=downloading_current+_0x3a04fa(0xad)+downloading_total,_0xb20bf5;}function create_download_icon(){const _0x35664b=a0_0x5b05;let _0x58edd0=document[_0x35664b(0x8b)](_0x35664b(0xce)),_0x3c5634=document['createElement'](_0x35664b(0x97));_0x3c5634['className']=_0x35664b(0xaf),_0x3c5634[_0x35664b(0xb6)](_0x35664b(0xb7),_0x35664b(0xc4)),_0x3c5634[_0x35664b(0x98)][_0x35664b(0xa6)]=_0x35664b(0xdc),_0x3c5634[_0x35664b(0x98)][_0x35664b(0x95)]=_0x35664b(0xe2),_0x58edd0[_0x35664b(0xca)](_0x3c5634);let _0x51d755=document[_0x35664b(0x8b)](_0x35664b(0xc3));_0x51d755[_0x35664b(0xac)]='stylesheet',_0x51d755[_0x35664b(0x8a)]=_0x35664b(0xd8),document[_0x35664b(0xdb)](_0x35664b(0xa3))[0x0]['appendChild'](_0x51d755);let _0x54a121=document[_0x35664b(0x8b)](_0x35664b(0xce));_0x54a121[_0x35664b(0x9b)]=_0x35664b(0x85),_0x54a121[_0x35664b(0x98)][_0x35664b(0x90)]=_0x35664b(0xe0),_0x54a121[_0x35664b(0x98)]['justifyContent']=_0x35664b(0x9f),_0x54a121[_0x35664b(0x98)][_0x35664b(0xb2)]=_0x35664b(0x9f),_0x54a121[_0x35664b(0x98)][_0x35664b(0xe5)]=_0x35664b(0xa1),_0x54a121[_0x35664b(0x98)][_0x35664b(0xa8)]=_0x35664b(0x91),_0x54a121['style'][_0x35664b(0x96)]='10000',_0x54a121[_0x35664b(0x98)][_0x35664b(0x93)]=_0x35664b(0xaa),_0x54a121[_0x35664b(0x98)]['left']=_0x35664b(0xde),_0x54a121[_0x35664b(0x98)]['transform']=_0x35664b(0x92);let _0x53c2ab=create_status_box();_0x53c2ab['style']['fontFamily']=_0x35664b(0xcc),_0x53c2ab[_0x35664b(0x98)][_0x35664b(0xe7)]=_0x35664b(0xdc),_0x53c2ab[_0x35664b(0x98)]['color']=_0x35664b(0x8c),_0x53c2ab[_0x35664b(0x98)][_0x35664b(0xb8)]=_0x35664b(0xd4),_0x53c2ab['style']['border']='0.2rem\x20solid\x20#167975',_0x53c2ab['style'][_0x35664b(0xd7)]='1rem',_0x53c2ab['style'][_0x35664b(0xc0)]=_0x35664b(0xab),_0x53c2ab['style'][_0x35664b(0xc2)]=_0x35664b(0x9d),_0x53c2ab['style'][_0x35664b(0xd1)]=_0x35664b(0xb9),_0x53c2ab['style'][_0x35664b(0x90)]=_0x35664b(0xc7),_0x54a121[_0x35664b(0xca)](_0x58edd0),_0x54a121[_0x35664b(0xca)](_0x53c2ab);let _0xb8a852=document[_0x35664b(0x87)](_0x35664b(0xc8)),_0x50eb29=_0xb8a852['firstChild'];return _0xb8a852[_0x35664b(0xda)](_0x54a121,_0x50eb29),_0x54a121;}const throttlePromises=async(_0x2997fb,_0x3788e6)=>{const _0x393b4c=a0_0x5b05;while(_0x2997fb[_0x393b4c(0xd2)]>0x0){await Promise[_0x393b4c(0xc5)](_0x2997fb[_0x393b4c(0xe9)](0x0,_0x3788e6)[_0x393b4c(0xb5)](_0x5d958a=>_0x5d958a())),await sleep(0xc8);}},h_descramble=(_0x2e76ff,_0x2567c1,_0x202c97)=>{const _0xa6ba49=a0_0x5b05;let _0x1bf027;const _0x24c255=Math[_0xa6ba49(0xa5)](_0x2e76ff['naturalWidth']/0x60),_0x4e9d61=Math[_0xa6ba49(0xa5)](_0x2e76ff[_0xa6ba49(0xd5)]/0x80);if(typeof _0x2567c1===_0xa6ba49(0xdf)){const _0x140a59=randomizer(_0x2567c1);_0x1bf027=[];for(let _0x8b567=0x0;_0x8b567<_0x24c255*_0x4e9d61;++_0x8b567){_0x1bf027[_0x8b567]=_0x8b567;}_0x1bf027=a_shuffle(_0x1bf027,_0x140a59);}const _0x2e572d=document[_0xa6ba49(0x8b)](_0xa6ba49(0x89));_0x2e572d[_0xa6ba49(0xa6)]=_0x2e76ff['naturalWidth'],_0x2e572d['height']=_0x2e76ff[_0xa6ba49(0xd5)];const _0x5c20ad=_0x2e572d[_0xa6ba49(0xa9)]('2d');_0x5c20ad['drawImage'](_0x2e76ff,0x0,0x0);for(let _0x35fdc0=0x0,_0x61e1ec=_0x1bf027[_0xa6ba49(0xd2)];_0x35fdc0<_0x61e1ec;++_0x35fdc0){const _0x5bed23=+_0x1bf027[_0x35fdc0],_0x547851=0x60*Math[_0xa6ba49(0xa5)](_0x35fdc0%_0x24c255),_0x31a23e=0x80*Math['floor'](_0x35fdc0/_0x24c255),_0x39680b=Math[_0xa6ba49(0xa2)](0x60*Math[_0xa6ba49(0xa5)](_0x5bed23%_0x24c255)),_0x382980=Math[_0xa6ba49(0xa2)](0x80*Math[_0xa6ba49(0xa5)](_0x5bed23/_0x24c255));_0x5c20ad[_0xa6ba49(0xa4)](_0x2e76ff,_0x547851,_0x31a23e,0x60,0x80,_0x39680b,_0x382980,0x60,0x80);}_0x2e572d[_0xa6ba49(0xe1)](_0x398d24=>{const _0x3fac65=_0xa6ba49;let _0x3ec2c3=(''+(_0x202c97+0x1))[_0x3fac65(0xd3)](0x3,'0')+'.jpg';downloadMode===_0x3fac65(0xe6)&&(_0x3ec2c3=folder_title+_0x3ec2c3);const _0x572bcf=URL[_0x3fac65(0x94)](_0x398d24);GM_download({'url':_0x572bcf,'name':_0x3ec2c3}),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();},_0xa6ba49(0xbd),0.98);},a_shuffle=(_0x4e10c6,_0x39a268)=>{let _0x2d92c9,_0x1a698a,_0x6e6bfc,_0x73594f,_0xe0496e,_0x5c3c34;for(_0xe0496e=[]['concat'](_0x4e10c6),_0x2d92c9=_0x6e6bfc=0x0,_0x73594f=_0xe0496e['length'];0x0<=_0x73594f?_0x6e6bfc<_0x73594f:_0x6e6bfc>_0x73594f;_0x2d92c9=0x0<=_0x73594f?++_0x6e6bfc:--_0x6e6bfc){_0x1a698a=e_rand(_0xe0496e['length']-0x1,_0x39a268),_0x5c3c34=_0xe0496e[_0x1a698a],_0xe0496e[_0x1a698a]=_0xe0496e[_0x2d92c9],_0xe0496e[_0x2d92c9]=_0x5c3c34;}return _0xe0496e;},randomizer=_0x267863=>({'next':str_to_int(_0x267863)}),next_int=_0x545269=>{const _0x2f904e=a0_0x5b05,_0x332c36=0x41c64e6d,_0x3edbcc=0x3039,_0xfd728=0x7fff;return _0x545269[_0x2f904e(0xb3)]=(_0x545269[_0x2f904e(0xb3)]*_0x332c36+_0x3edbcc)%(_0xfd728+0x1),_0x545269['next'];},e_rand=(_0x3cd4e0,_0x249d58)=>{const _0x50468a=a0_0x5b05,_0x2a0717=0x7fff;let _0x3688d9;return _0x3cd4e0!==null?(_0x3688d9=_0x3cd4e0+0x1,Math[_0x50468a(0xa5)](next_int(_0x249d58)/(Math[_0x50468a(0xa5)](_0x2a0717/_0x3688d9)+0x1))):next_int(_0x249d58);},str_to_int=_0x167347=>{const _0x46d789=a0_0x5b05;let _0x26ac7f,_0xe6961e,_0x55d3a1,_0x50182f,_0x4046dc,_0x1b1a1d=0x0;if(_0x167347!==null)for(_0x26ac7f=_0x167347[_0x46d789(0x8d)]('');_0x26ac7f['length']>0x0;){_0xe6961e=_0x26ac7f[_0x46d789(0xa7)](),_0x55d3a1=_0x26ac7f[_0x46d789(0xa7)](),_0x50182f=_0xe6961e[_0x46d789(0xae)](0x0),_0x4046dc=0x0,_0x55d3a1&&(_0x4046dc=_0x55d3a1[_0x46d789(0xae)](0x0)),_0x1b1a1d+=_0x50182f<<0x8|_0x4046dc;}return _0x1b1a1d;},download=async(_0x15a9a0,_0x4dab9f,_0x3f60e8,_0x57130d)=>{const _0x24f72f=a0_0x5b05,_0x6a08e0=_0x4dab9f?await createImageFileName(_0x57130d,_0x4dab9f,_0x3f60e8):_0x57130d+0x1+'.jpg',_0x28637f=''+api_url_root+_0x6a08e0;try{const _0x37b17f=await load_image(_0x28637f);h_descramble(_0x37b17f,_0x15a9a0,_0x57130d);}catch(_0x348da6){console[_0x24f72f(0xb0)](_0x24f72f(0x9a));}},createImageFileName=async(_0x164357,_0x36a896,_0x5ae85f,_0x1d5184)=>{return _0x164357+=0x1,_0x1d5184=_0x1d5184?_0x1d5184+String(_0x164357):_0x164357,(_0x36a896?await o(_0x36a896,_0x1d5184):_0x164357)+'.'+_0x5ae85f;},o=async(_0xcb8c2,_0x3205b4)=>{const _0x2f09c0=a0_0x5b05,_0x1e23b4=new TextEncoder();_0x3205b4=_0x1e23b4[_0x2f09c0(0x8e)](_0x3205b4),_0xcb8c2=_0x1e23b4[_0x2f09c0(0x8e)](_0xcb8c2),_0xcb8c2=await window['crypto'][_0x2f09c0(0xb1)]['importKey'](_0x2f09c0(0xe3),_0xcb8c2,{'name':'HMAC','hash':{'name':_0x2f09c0(0xe4)}},!0x1,[_0x2f09c0(0xa0)]),_0xcb8c2=await window[_0x2f09c0(0x9c)][_0x2f09c0(0xb1)][_0x2f09c0(0xa0)]('HMAC',_0xcb8c2,_0x3205b4);{_0x3205b4=_0xcb8c2;let _0x28ba3d='',_0x23501d=new Uint8Array(_0x3205b4),_0x287ddb=_0x23501d[_0x2f09c0(0xdd)];for(let _0x469b76=0x0;_0x469b76<_0x287ddb;_0x469b76++){_0x28ba3d+=String[_0x2f09c0(0xeb)](_0x23501d[_0x469b76]);}return btoa(_0x28ba3d)[_0x2f09c0(0xc6)](/=/g,'')['replace'](/\+/g,'-')[_0x2f09c0(0xc6)](/\//g,'_');}};((async()=>{'use strict';const _0x300354=a0_0x5b05;const _0xf8baa7=document[_0x300354(0x8f)]['outerHTML'],_0x2d27e6=_0xf8baa7[_0x300354(0xc9)](/GUARDIAN_SERVER = '(.+?)';/)[0x1],_0xab4e8d=JSON[_0x300354(0xcf)]('['+_0xf8baa7[_0x300354(0xc9)](/"keys": \[(.+?)]/)[0x1]+']'),_0x193731=JSON[_0x300354(0xcf)]('{'+_0xf8baa7[_0x300354(0xc9)](/var book_data={(.+?)};/)[0x1]+'}'),{s3_key:_0x459d18,title:_0x55f836,page_salt:_0x4c1abc,image_extension:_0x38f63e}=_0x193731;api_url_root=_0x2d27e6+'/'+_0x459d18,folder_title=decodeURIComponent(_0x55f836)['trim']()[_0x300354(0xc6)]('.','');folder_title?folder_title=folder_title+'/':folder_title='';if(_0xab4e8d['length']>0x0){downloading_total=_0xab4e8d[_0x300354(0xd2)];const _0xbf9e19=create_download_icon();_0xbf9e19[_0x300354(0xea)](_0x300354(0xbf),async()=>{on_heartbeat_css(),downloading_current=0x0;let _0x34c017=_0xab4e8d['map']((_0x1d89ed,_0x529ed2)=>()=>download(_0x1d89ed,_0x4c1abc,_0x38f63e,_0x529ed2));await throttlePromises(_0x34c017,0x2);});}})());