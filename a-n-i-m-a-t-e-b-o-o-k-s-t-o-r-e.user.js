// ==UserScript==
// @name         a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e
// @namespace    https://github.com/kanekoryusei5678/thuyen_lai_buon/raw/main/a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e.user.js
// @version      2024.08.12
// @description  down a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e
// @author       You
// @include      /^https:\/\/www.[a@]nim[a@]teb[o0]okst[o0]re.c[o0]m\/viewer\/.+/
// @icon         https://raw.githubusercontent.com/kanekoryusei5678/thuyen_lai_buon/main/a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e.png
// @grant        GM_download
// @grant        GM_info
// @downloadURL  https://github.com/kanekoryusei5678/thuyen_lai_buon/raw/main/a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e.user.js
// @updateURL    https://github.com/kanekoryusei5678/thuyen_lai_buon/raw/main/a-n-i-m-a-t-e-b-o-o-k-s-t-o-r-e.meta.js
// ==/UserScript==

const a0_0x40773b=a0_0x18c1;function a0_0x50ce(){const _0x433d92=['Anonymous','3rem','error','\x0a\x20\x20\x20\x20\x20\x20.tai-ve\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20animation:\x20heartbeat\x202s\x20infinite;\x20/*\x20Apply\x20the\x20heartbeat\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform-origin:\x20center;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20@keyframes\x20heartbeat\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x200%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Start\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2025%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2025%\x20of\x20the\x20animation\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2050%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1.2);\x20/*\x20Scale\x20up\x20at\x2050%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20Return\x20to\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x2075%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x200.7;\x20/*\x20Fade\x20out\x20slightly\x20at\x2075%\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20100%\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20transform:\x20scale(1);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20opacity:\x201;\x20/*\x20End\x20with\x20full\x20opacity\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20','\x20/\x20','gap','width','status','charCodeAt','display','top','src','alignItems','byteLength','pointer','https://github.com/NAgEustiCa/1_con_kien_2_con_kien/raw/main/tai_icon.png','backgroundColor','8228224NIOMtS','center','href','padding','floor','encode','translate(-50%)','#FD7377','2RxMlKR','setAttribute','string','split','insertBefore','tai-ve','appendChild','splice','className','all','importKey','1809024txAeyV','#F9FDFD','rel','div','addEventListener','status-num','#heartbeat','round','createObjectURL','height','length','sign','textContent','replace','getElementsByTagName','10000','HMAC','boxShadow','padStart','head','downloadMode','crypto','log','documentElement','https://fonts.googleapis.com/css2?family=Acme&display=swap','.25rem\x20.4rem\x20#2E8B87','flex','toBlob','388384LRoTnj','raw','205788xXVdkp','160161yQEXVV','10955RLtpeG','canvas','absolute','next','match','innerHTML','querySelector','fromCharCode','position','trim','0.2rem\x20solid\x20#167975','outerHTML','naturalWidth','left','map','parse','firstChild','shift','1px\x20#C62428','1348134uONSoP','createElement','concat','cursor','subtle','fontFamily','50vw','zIndex','getContext','border','naturalHeight','0.5rem','img','.status-num','1rem','block','style','webkitTextStroke'];a0_0x50ce=function(){return _0x433d92;};return a0_0x50ce();}(function(_0x567922,_0xe452e2){const _0x2ac87b=a0_0x18c1,_0x5ea1e5=_0x567922();while(!![]){try{const _0x5695b5=-parseInt(_0x2ac87b(0x11c))/0x1*(parseInt(_0x2ac87b(0xf2))/0x2)+-parseInt(_0x2ac87b(0x11b))/0x3+-parseInt(_0x2ac87b(0x119))/0x4+-parseInt(_0x2ac87b(0x11d))/0x5+-parseInt(_0x2ac87b(0xc7))/0x6+-parseInt(_0x2ac87b(0xfd))/0x7+parseInt(_0x2ac87b(0xea))/0x8;if(_0x5695b5===_0xe452e2)break;else _0x5ea1e5['push'](_0x5ea1e5['shift']());}catch(_0xba762f){_0x5ea1e5['push'](_0x5ea1e5['shift']());}}}(a0_0x50ce,0x35113));let downloading_current=0x0,downloading_total=0x0;function a0_0x18c1(_0x4fb051,_0x44c85e){const _0x50ce09=a0_0x50ce();return a0_0x18c1=function(_0x18c1af,_0x1538f6){_0x18c1af=_0x18c1af-0xbf;let _0x4cca61=_0x50ce09[_0x18c1af];return _0x4cca61;},a0_0x18c1(_0x4fb051,_0x44c85e);}const downloadMode=GM_info[a0_0x40773b(0x111)];let folder_title='',api_url_root='';function sleep(_0x39e9de){return new Promise(_0xfd86ae=>setTimeout(_0xfd86ae,_0x39e9de));}const load_image=_0x5cfcaf=>new Promise((_0x3c292d,_0x428cd5)=>{const _0x1486df=a0_0x40773b,_0x2d872c=new Image();_0x2d872c[_0x1486df(0x101)]('load',()=>{_0x3c292d(_0x2d872c);}),_0x2d872c['addEventListener'](_0x1486df(0xdb),()=>{_0x428cd5(new Error('Failed\x20to\x20load\x20image'));}),_0x2d872c[_0x1486df(0xe4)]=_0x5cfcaf,_0x2d872c['crossOrigin']=_0x1486df(0xd9);}),on_heartbeat_css=()=>{const _0x3dce72=a0_0x40773b;let _0x5036fd=document[_0x3dce72(0x123)](_0x3dce72(0x103));!_0x5036fd&&(_0x5036fd=document[_0x3dce72(0xc8)]('style'),_0x5036fd[_0x3dce72(0xf3)]('id','heartbeat'),document[_0x3dce72(0x110)]['appendChild'](_0x5036fd)),_0x5036fd[_0x3dce72(0x109)]=_0x3dce72(0xdc);},off_heartbeat_css=()=>{const _0x36a3c6=a0_0x40773b,_0x34a35b=document[_0x36a3c6(0x123)](_0x36a3c6(0x103));_0x34a35b['textContent']='';};function update_status(){const _0x2a09ca=a0_0x40773b;document[_0x2a09ca(0x123)](_0x2a09ca(0xd4))[_0x2a09ca(0xd7)][_0x2a09ca(0xe2)]=_0x2a09ca(0xd6),document[_0x2a09ca(0x123)](_0x2a09ca(0xd4))[_0x2a09ca(0x122)]=downloading_current+_0x2a09ca(0xdd)+downloading_total;}function create_status_box(){const _0x299479=a0_0x40773b;let _0x4a1d4c=document[_0x299479(0xc8)](_0x299479(0x100));return _0x4a1d4c[_0x299479(0xfa)]=_0x299479(0x102),_0x4a1d4c[_0x299479(0x109)]=downloading_current+'\x20/\x20'+downloading_total,_0x4a1d4c;}function create_download_icon(){const _0x499879=a0_0x40773b;let _0xb2914e=document['createElement'](_0x499879(0x100)),_0x459b53=document[_0x499879(0xc8)](_0x499879(0xd3));_0x459b53[_0x499879(0xfa)]=_0x499879(0xf7),_0x459b53[_0x499879(0xf3)]('src',_0x499879(0xe8)),_0x459b53[_0x499879(0xd7)][_0x499879(0xdf)]=_0x499879(0xda),_0x459b53[_0x499879(0xd7)][_0x499879(0xca)]=_0x499879(0xe7),_0xb2914e[_0x499879(0xf8)](_0x459b53);let _0x487867=document[_0x499879(0xc8)]('link');_0x487867[_0x499879(0xff)]='stylesheet',_0x487867[_0x499879(0xec)]=_0x499879(0x115),document[_0x499879(0x10b)](_0x499879(0x110))[0x0]['appendChild'](_0x487867);let _0x1f796c=document['createElement'](_0x499879(0x100));_0x1f796c[_0x499879(0xfa)]=_0x499879(0xe0),_0x1f796c['style'][_0x499879(0xe2)]=_0x499879(0x117),_0x1f796c[_0x499879(0xd7)]['justifyContent']=_0x499879(0xeb),_0x1f796c[_0x499879(0xd7)][_0x499879(0xe5)]=_0x499879(0xeb),_0x1f796c[_0x499879(0xd7)][_0x499879(0xde)]='1.5rem',_0x1f796c[_0x499879(0xd7)][_0x499879(0x125)]=_0x499879(0x11f),_0x1f796c[_0x499879(0xd7)][_0x499879(0xce)]=_0x499879(0x10c),_0x1f796c[_0x499879(0xd7)][_0x499879(0xe3)]=_0x499879(0xd2),_0x1f796c[_0x499879(0xd7)][_0x499879(0xc1)]=_0x499879(0xcd),_0x1f796c[_0x499879(0xd7)]['transform']=_0x499879(0xf0);let _0x2f68c2=create_status_box();_0x2f68c2[_0x499879(0xd7)][_0x499879(0xcc)]='\x27Acme\x27,\x20sans-serif',_0x2f68c2[_0x499879(0xd7)]['fontSize']=_0x499879(0xda),_0x2f68c2[_0x499879(0xd7)]['color']=_0x499879(0xf1),_0x2f68c2['style'][_0x499879(0xd8)]=_0x499879(0xc6),_0x2f68c2['style'][_0x499879(0xd0)]=_0x499879(0x127),_0x2f68c2[_0x499879(0xd7)]['borderRadius']=_0x499879(0xd5),_0x2f68c2[_0x499879(0xd7)][_0x499879(0xed)]='0\x202rem',_0x2f68c2[_0x499879(0xd7)][_0x499879(0xe9)]=_0x499879(0xfe),_0x2f68c2[_0x499879(0xd7)][_0x499879(0x10e)]=_0x499879(0x116),_0x2f68c2[_0x499879(0xd7)][_0x499879(0xe2)]='none',_0x1f796c[_0x499879(0xf8)](_0xb2914e),_0x1f796c[_0x499879(0xf8)](_0x2f68c2);let _0x2b1cae=document[_0x499879(0x123)]('body'),_0x56ac75=_0x2b1cae[_0x499879(0xc4)];return _0x2b1cae[_0x499879(0xf6)](_0x1f796c,_0x56ac75),_0x1f796c;}const throttlePromises=async(_0xda3d75,_0x3adda6)=>{const _0x5ee4b1=a0_0x40773b;while(_0xda3d75[_0x5ee4b1(0x107)]>0x0){await Promise[_0x5ee4b1(0xfb)](_0xda3d75[_0x5ee4b1(0xf9)](0x0,_0x3adda6)[_0x5ee4b1(0xc2)](_0x557e7e=>_0x557e7e())),await sleep(0xc8);}},h_descramble=(_0x56bfe0,_0x41a9d2,_0x5b2250)=>{const _0xc0c98b=a0_0x40773b;let _0x394639;const _0x2a3c98=Math[_0xc0c98b(0xee)](_0x56bfe0[_0xc0c98b(0xc0)]/0x60),_0x487bd7=Math[_0xc0c98b(0xee)](_0x56bfe0[_0xc0c98b(0xd1)]/0x80);if(typeof _0x41a9d2===_0xc0c98b(0xf4)){const _0x2a925b=randomizer(_0x41a9d2);_0x394639=[];for(let _0x5642ae=0x0;_0x5642ae<_0x2a3c98*_0x487bd7;++_0x5642ae){_0x394639[_0x5642ae]=_0x5642ae;}_0x394639=a_shuffle(_0x394639,_0x2a925b);}const _0x4c102c=document['createElement'](_0xc0c98b(0x11e));_0x4c102c[_0xc0c98b(0xdf)]=_0x56bfe0[_0xc0c98b(0xc0)],_0x4c102c[_0xc0c98b(0x106)]=_0x56bfe0[_0xc0c98b(0xd1)];const _0x44323d=_0x4c102c[_0xc0c98b(0xcf)]('2d');_0x44323d['drawImage'](_0x56bfe0,0x0,0x0);for(let _0x4965dd=0x0,_0x32d105=_0x394639[_0xc0c98b(0x107)];_0x4965dd<_0x32d105;++_0x4965dd){const _0x30e702=+_0x394639[_0x4965dd],_0x2fbe41=0x60*Math[_0xc0c98b(0xee)](_0x4965dd%_0x2a3c98),_0x58563c=0x80*Math['floor'](_0x4965dd/_0x2a3c98),_0x5ba430=Math[_0xc0c98b(0x104)](0x60*Math['floor'](_0x30e702%_0x2a3c98)),_0x375ea6=Math[_0xc0c98b(0x104)](0x80*Math[_0xc0c98b(0xee)](_0x30e702/_0x2a3c98));_0x44323d['drawImage'](_0x56bfe0,_0x2fbe41,_0x58563c,0x60,0x80,_0x5ba430,_0x375ea6,0x60,0x80);}_0x4c102c[_0xc0c98b(0x118)](_0xcd8b7f=>{const _0x34668e=_0xc0c98b;let _0x262b73=(''+(_0x5b2250+0x1))[_0x34668e(0x10f)](0x3,'0')+'.jpg';downloadMode==='browser'&&(_0x262b73=folder_title+_0x262b73);const _0x23f734=URL[_0x34668e(0x105)](_0xcd8b7f);GM_download({'url':_0x23f734,'name':_0x262b73}),downloading_current+=0x1,downloading_current===downloading_total&&off_heartbeat_css(),update_status();},'image/jpeg',0.98);},a_shuffle=(_0x42bd9f,_0x265759)=>{const _0x3a58a6=a0_0x40773b;let _0x45819,_0x3adc34,_0x60eae8,_0x4a5f2d,_0x5436af,_0xece36b;for(_0x5436af=[][_0x3a58a6(0xc9)](_0x42bd9f),_0x45819=_0x60eae8=0x0,_0x4a5f2d=_0x5436af[_0x3a58a6(0x107)];0x0<=_0x4a5f2d?_0x60eae8<_0x4a5f2d:_0x60eae8>_0x4a5f2d;_0x45819=0x0<=_0x4a5f2d?++_0x60eae8:--_0x60eae8){_0x3adc34=e_rand(_0x5436af[_0x3a58a6(0x107)]-0x1,_0x265759),_0xece36b=_0x5436af[_0x3adc34],_0x5436af[_0x3adc34]=_0x5436af[_0x45819],_0x5436af[_0x45819]=_0xece36b;}return _0x5436af;},randomizer=_0x3ad83e=>({'next':str_to_int(_0x3ad83e)}),next_int=_0x247408=>{const _0x2a53b8=a0_0x40773b,_0x16fb30=0x41c64e6d,_0x41194a=0x3039,_0xb276d6=0x7fff;return _0x247408['next']=(_0x247408[_0x2a53b8(0x120)]*_0x16fb30+_0x41194a)%(_0xb276d6+0x1),_0x247408[_0x2a53b8(0x120)];},e_rand=(_0x51f2ea,_0x326171)=>{const _0x588d58=a0_0x40773b,_0x59fa44=0x7fff;let _0x57c76d;return _0x51f2ea!==null?(_0x57c76d=_0x51f2ea+0x1,Math[_0x588d58(0xee)](next_int(_0x326171)/(Math[_0x588d58(0xee)](_0x59fa44/_0x57c76d)+0x1))):next_int(_0x326171);},str_to_int=_0x329f2c=>{const _0x4db7d4=a0_0x40773b;let _0x55f765,_0x54bbcf,_0xf2e1a6,_0x20dc56,_0x5d5279,_0x31a554=0x0;if(_0x329f2c!==null)for(_0x55f765=_0x329f2c[_0x4db7d4(0xf5)]('');_0x55f765[_0x4db7d4(0x107)]>0x0;){_0x54bbcf=_0x55f765['shift'](),_0xf2e1a6=_0x55f765[_0x4db7d4(0xc5)](),_0x20dc56=_0x54bbcf[_0x4db7d4(0xe1)](0x0),_0x5d5279=0x0,_0xf2e1a6&&(_0x5d5279=_0xf2e1a6[_0x4db7d4(0xe1)](0x0)),_0x31a554+=_0x20dc56<<0x8|_0x5d5279;}return _0x31a554;},download=async(_0x183f8b,_0x97b1c7,_0x3570f6,_0x91a8c6)=>{const _0x1f994a=a0_0x40773b,_0xaeb9ee=await createImageFileName(_0x91a8c6,_0x97b1c7,_0x3570f6),_0x5d3c7d=''+api_url_root+_0xaeb9ee;try{const _0x356c08=await load_image(_0x5d3c7d);h_descramble(_0x356c08,_0x183f8b,_0x91a8c6);}catch(_0x486f1b){console[_0x1f994a(0x113)]('Error');}},createImageFileName=async(_0x3daafc,_0x34dc3e,_0x5a225b,_0xdeff9b)=>{return _0x3daafc+=0x1,_0xdeff9b=_0xdeff9b?_0xdeff9b+String(_0x3daafc):_0x3daafc,(_0x34dc3e?await o(_0x34dc3e,_0xdeff9b):_0x3daafc)+'.'+_0x5a225b;},o=async(_0x2af127,_0xcb6720)=>{const _0x210951=a0_0x40773b,_0x319458=new TextEncoder();_0xcb6720=_0x319458[_0x210951(0xef)](_0xcb6720),_0x2af127=_0x319458[_0x210951(0xef)](_0x2af127),_0x2af127=await window[_0x210951(0x112)][_0x210951(0xcb)][_0x210951(0xfc)](_0x210951(0x11a),_0x2af127,{'name':'HMAC','hash':{'name':'SHA-256'}},!0x1,[_0x210951(0x108)]),_0x2af127=await window[_0x210951(0x112)][_0x210951(0xcb)][_0x210951(0x108)](_0x210951(0x10d),_0x2af127,_0xcb6720);{_0xcb6720=_0x2af127;let _0x2925ba='',_0x75cfa0=new Uint8Array(_0xcb6720),_0x348b15=_0x75cfa0[_0x210951(0xe6)];for(let _0x1f1cf1=0x0;_0x1f1cf1<_0x348b15;_0x1f1cf1++){_0x2925ba+=String[_0x210951(0x124)](_0x75cfa0[_0x1f1cf1]);}return btoa(_0x2925ba)['replace'](/=/g,'')[_0x210951(0x10a)](/\+/g,'-')[_0x210951(0x10a)](/\//g,'_');}};((async()=>{'use strict';const _0x83c214=a0_0x40773b;const _0x56788b=document[_0x83c214(0x114)][_0x83c214(0xbf)],_0x5d1d3f=_0x56788b[_0x83c214(0x121)](/GUARDIAN_SERVER = '(.+?)';/)[0x1],_0x5d7e32=JSON[_0x83c214(0xc3)]('['+_0x56788b[_0x83c214(0x121)](/"keys": \[(.+?)]/)[0x1]+']'),_0x125241=JSON[_0x83c214(0xc3)]('{'+_0x56788b['match'](/var book_data={(.+?)};/)[0x1]+'}'),{s3_key:_0x518b81,title:_0x8b26d8,page_salt:_0x804257,image_extension:_0x554eae}=_0x125241;api_url_root=_0x5d1d3f+'/'+_0x518b81,folder_title=decodeURIComponent(_0x8b26d8)[_0x83c214(0x126)]()[_0x83c214(0x10a)]('.','');folder_title?folder_title=folder_title+'/':folder_title='';if(_0x5d7e32['length']>0x0){downloading_total=_0x5d7e32['length'];const _0x53d581=create_download_icon();_0x53d581[_0x83c214(0x101)]('click',async()=>{const _0x221bcf=_0x83c214;on_heartbeat_css(),downloading_current=0x0;let _0x65cb7f=_0x5d7e32[_0x221bcf(0xc2)]((_0x535450,_0x41696e)=>()=>download(_0x535450,_0x804257,_0x554eae,_0x41696e));await throttlePromises(_0x65cb7f,0x2);});}})());